import{a as ft,b as Ct}from"./chunk-B3WZX5Z5.js";import{a as ht}from"./chunk-NX5QT64V.js";import{e as rt}from"./chunk-4E2VJWSK.js";import{a as st,b as ct,d as dt,g as lt,l as pt,m as mt,n as gt,u as ut,w as Y,x as _t,y as xt}from"./chunk-IEVIATPJ.js";import{$ as F,$a as k,Ea as G,Ia as y,Tb as nt,Ub as it,Va as _,Vb as ot,Wa as r,Xa as s,Xb as at,Ya as M,Z as h,Za as q,_ as x,_a as J,aa as L,ab as v,bb as d,c as B,cb as Q,db as X,eb as K,fb as U,gb as z,hb as D,jb as p,kb as w,lb as O,mb as Z,ob as I,pb as V,qb as $,ua as c,ub as tt,vb as et,ya as A,zb as R}from"./chunk-X7ILVH5W.js";var Dt=["patientSearchInput"],Et=(o,m,n,t,e,i,a,l)=>({"appointment-block":o,"appointment-block-multi":m,"appointment-block-continued":n,"bg-warning":t,"bg-primary":e,"text-white":i,"status-pending":a,"status-paid":l}),At=(o,m,n,t)=>({"bg-warning":o,"bg-primary text-white":m,"status-pending":n,"status-paid":t});function Tt(o,m){if(o&1){let n=k();r(0,"div",12)(1,"h2",13),p(2,"Calendario de Citas"),s(),r(3,"div",14)(4,"button",15),v("click",function(){h(n);let e=d();return x(e.setViewMode("month"))}),p(5,"Mes"),s(),r(6,"button",15),v("click",function(){h(n);let e=d();return x(e.setViewMode("week"))}),p(7,"Semana"),s(),r(8,"button",15),v("click",function(){h(n);let e=d();return x(e.setViewMode("day"))}),p(9,"D\xEDa"),s()()()}if(o&2){let n=d();c(4),D("active",n.viewMode==="month"),c(2),D("active",n.viewMode==="week"),c(2),D("active",n.viewMode==="day")}}function It(o,m){if(o&1&&(r(0,"span"),p(1),r(2,"small",24),p(3),s()()),o&2){let n=d(2);c(),O(" Semana del ",n.formatDate(n.getWeekDays()[0])," "),c(2),O("(Total semana: ",n.formatPriceCents(n.getWeekTotal()),")")}}function Vt(o,m){if(o&1&&(r(0,"span"),p(1),r(2,"small",24),p(3),s()()),o&2){let n=d(2);c(),O(" ",n.formatDate(n.currentDate)," "),c(2),O("(Total d\xEDa: ",n.formatPriceCents(n.getDayTotal(n.currentDate)),")")}}function $t(o,m){if(o&1){let n=k();r(0,"div",16)(1,"div",17)(2,"button",18),v("click",function(){h(n);let e=d();return x(e.previousPeriod())}),M(3,"i",19),s()(),r(4,"h3",20),y(5,It,4,2,"span",21)(6,Vt,4,2,"span",21),s(),r(7,"div",17)(8,"button",22),v("click",function(){h(n);let e=d();return x(e.goToToday())}),p(9,"Hoy"),s(),r(10,"button",18),v("click",function(){h(n);let e=d();return x(e.nextPeriod())}),M(11,"i",23),s()()()}if(o&2){let n=d();c(5),_("ngIf",n.viewMode==="week"),c(),_("ngIf",n.viewMode==="day")}}function Nt(o,m){if(o&1&&(r(0,"div",43),p(1),s()),o&2){let n=m.$implicit;c(),w(n)}}function Ft(o,m){if(o&1){let n=k();r(0,"div",44),v("click",function(){let e=h(n).$implicit,i=d(3);return e&&i.setViewMode("day"),x(i.currentDate=e)}),r(1,"div",45),p(2),s()()}if(o&2){let n=m.$implicit,t=d(3);D("has-appointments-compact",n&&t.getAppointmentsForDate(n).length>0)("holiday-compact",n&&t.isHoliday(n)&&t.getAppointmentsForDate(n).length===0)("weekend-compact",n&&!t.isHoliday(n)&&(n.getDay()===0||n.getDay()===6)),c(2),w(n?n.getDate():"")}}function Lt(o,m){if(o&1){let n=k();r(0,"div",31)(1,"h6",32),p(2),r(3,"small",33),p(4),s(),r(5,"button",34),v("click",function(){let e=h(n).index,i=d(2);return x(i.exportMonthCsv(i.currentYear,e,"appointment"))}),F(),r(6,"svg",35),M(7,"path",36)(8,"path",37),s()(),L(),r(9,"button",38),v("click",function(){let e=h(n).index,i=d(2);return x(i.exportMonthCsv(i.currentYear,e,"patient"))}),F(),r(10,"svg",35),M(11,"path",39),s()()(),L(),r(12,"div",40),y(13,Nt,2,1,"div",41)(14,Ft,3,7,"div",42),s()()}if(o&2){let n=m.$implicit,t=m.index,e=d(2);c(2),O(" ",n," "),c(2),O("(",e.formatPriceCents(e.getMonthTotal(e.currentYear,t)),")"),c(9),_("ngForOf",e.weekDays),c(),_("ngForOf",e.getMonthDaysOfYear(e.currentYear,t))}}function Ut(o,m){if(o&1){let n=k();r(0,"div",25)(1,"div",26)(2,"button",27),v("click",function(){h(n);let e=d();return x(e.previousYear())}),M(3,"i",19),s(),r(4,"h4",13),p(5),s(),r(6,"button",28),v("click",function(){h(n);let e=d();return x(e.nextYear())}),M(7,"i",23),s()(),r(8,"div",29),y(9,Lt,15,4,"div",30),s()()}if(o&2){let n=d();c(5),w(n.currentYear),c(4),_("ngForOf",n.months)}}function zt(o,m){if(o&1&&(r(0,"div",51)(1,"div",52),p(2),s(),r(3,"div",53),p(4),s()()),o&2){let n=m.$implicit,t=d(2);D("weekend",t.isWeekend(n))("today",t.isToday(n)),c(2),w(t.getDayName(n.getDay())),c(2),w(n.getDate())}}function Rt(o,m){if(o&1&&(q(0),r(1,"div",61)(2,"strong",62),p(3),s(),r(4,"div",63),p(5),s(),r(6,"div",64),p(7),s()(),J()),o&2){let n=d().ngIf,t=d(4);c(3),w(t.getPatientName(n)),c(2),w(t.formatTimeRange(n.start,n.end)),c(2),w(t.getAppointmentOrigin(n))}}function Yt(o,m){if(o&1&&(r(0,"div",65)(1,"strong",62),p(2),s(),r(3,"div",63),p(4),s(),r(5,"div",64),p(6),s()()),o&2){let n=d().ngIf,t=d(4);c(2),w(t.getPatientName(n)),c(2),O("",t.formatTimeRange(n.start,n.end)," "),c(2),w(t.getAppointmentOrigin(n))}}function jt(o,m){if(o&1){let n=k();r(0,"div",59),v("click",function(e){let i=h(n).ngIf;return d(4).openEditAppointmentModal(i),x(e.stopPropagation())}),y(1,Rt,8,3,"ng-container",60)(2,Yt,7,3,"ng-template",null,0,R),s()}if(o&2){let n=m.ngIf,t=U(3),e=d().$implicit,i=d().$implicit,a=d(2);_("ngClass",et(3,Et,a.isAppointmentStart(n,e,i)||!a.isAppointmentStart(n,e,i)&&a.appointmentSpansMultipleSlots(n),a.isAppointmentStart(n,e,i)&&a.appointmentSpansMultipleSlots(n),!a.isAppointmentStart(n,e,i)&&a.appointmentSpansMultipleSlots(n),a.getAppointmentPaymentStatus(n)==="pending",a.getAppointmentPaymentStatus(n)==="paid",a.getAppointmentPaymentStatus(n)==="paid",a.getAppointmentPaymentStatus(n)==="pending",a.getAppointmentPaymentStatus(n)==="paid")),c(),_("ngIf",a.isAppointmentStart(n,e,i))("ngIfElse",t)}}function Wt(o,m){if(o&1){let n=k();r(0,"div",57),v("click",function(){let e=h(n).$implicit,i=d().$implicit,a=d(2);return x(a.openCreateAppointmentModal(e,i))}),y(1,jt,4,12,"div",58),s()}if(o&2){let n=m.$implicit,t=d().$implicit,e=d(2);D("weekend",e.isWeekend(n)),c(),_("ngIf",e.getAppointmentForTimeSlot(n,t))}}function Ht(o,m){if(o&1&&(r(0,"div",54)(1,"div",55),p(2),s(),y(3,Wt,2,3,"div",56),s()),o&2){let n=m.$implicit,t=d(2);c(2),w(n),c(),_("ngForOf",t.getWeekDays())}}function Bt(o,m){if(o&1&&(r(0,"div",46)(1,"div",47),M(2,"div",48),y(3,zt,5,6,"div",49)(4,Ht,4,2,"div",50),s()()),o&2){let n=d();c(3),_("ngForOf",n.getWeekDays()),c(),_("ngForOf",n.timeSlots)}}function Gt(o,m){if(o&1){let n=k();r(0,"div",73),v("click",function(e){let i=h(n).ngIf;return d(3).openEditAppointmentModal(i),x(e.stopPropagation())}),r(1,"div",74)(2,"div")(3,"strong"),p(4),s(),r(5,"div",75),p(6),s()(),r(7,"div",76)(8,"button",77),v("click",function(e){let i=h(n).ngIf;return d(3).openEditAppointmentModal(i),x(e.stopPropagation())}),M(9,"i",78),s(),r(10,"button",79),v("click",function(e){let i=h(n).ngIf;return d(3).deleteAppointment(i.id),x(e.stopPropagation())}),M(11,"i",80),s()()(),r(12,"div",64),p(13),s()()}if(o&2){let n=m.ngIf,t=d(3);_("ngClass",tt(4,At,t.getAppointmentPaymentStatus(n)==="pending",t.getAppointmentPaymentStatus(n)==="paid",t.getAppointmentPaymentStatus(n)==="pending",t.getAppointmentPaymentStatus(n)==="paid")),c(4),w(t.getPatientName(n)),c(2),O(" ",t.formatTimeRange(n.start,n.end)," "),c(7),w(t.getAppointmentOrigin(n))}}function qt(o,m){o&1&&(r(0,"div",81),M(1,"i",82),r(2,"small",33),p(3,"Agregar cita"),s()())}function Jt(o,m){if(o&1){let n=k();r(0,"div",70),v("click",function(){let e=h(n).$implicit,i=d(2);return x(i.openCreateAppointmentModal(i.currentDate,e))}),r(1,"div",55),p(2),s(),r(3,"div",71),y(4,Gt,14,9,"div",72)(5,qt,4,0,"ng-template",null,1,R),s()()}if(o&2){let n=m.$implicit,t=U(6),e=d(2);c(2),w(n),c(2),_("ngIf",e.getAppointmentForTimeSlot(e.currentDate,n))("ngIfElse",t)}}function Qt(o,m){if(o&1&&(r(0,"div",66)(1,"div",67)(2,"div",68),y(3,Jt,7,3,"div",69),s()()()),o&2){let n=d();c(3),_("ngForOf",n.timeSlots)}}function Xt(o,m){if(o&1&&(r(0,"div",75),p(1),s()),o&2){let n=d().$implicit;c(),w(n.email)}}function Kt(o,m){if(o&1){let n=k();r(0,"div",98),v("click",function(){let e=h(n).$implicit,i=d(2);return x(i.selectPatient(e))})("touchstart",function(){let e=h(n).$implicit,i=d(2);return x(i.selectPatient(e))}),r(1,"div",99)(2,"div")(3,"strong"),p(4),s(),r(5,"div",75),p(6),s(),y(7,Xt,2,1,"div",100),s(),r(8,"div",101)(9,"span",102),p(10),s()()()()}if(o&2){let n=m.$implicit,t=d(2);D("selected",(t.selectedPatient==null?null:t.selectedPatient.id)===n.id),c(4),Z("",n.firstName," ",n.lastName),c(2),w(n.phone),c(),_("ngIf",n.email),c(2),D("bg-success",(n.activeSessions||0)>0)("bg-danger",(n.activeSessions||0)===0),c(),O(" ",n.activeSessions||0," sesiones ")}}function Zt(o,m){o&1&&(r(0,"div",103),p(1," No se encontraron pacientes "),s())}function te(o,m){o&1&&(r(0,"span"),p(1,"Crear Cita"),s())}function ee(o,m){o&1&&(r(0,"span"),p(1,"Creando..."),s())}function ne(o,m){if(o&1){let n=k();r(0,"div",83)(1,"div",84)(2,"div",85)(3,"div",86)(4,"h5",87),p(5,"Seleccionar Paciente"),s(),r(6,"button",88),v("click",function(){h(n);let e=d();return x(e.closeModal())}),s()(),r(7,"div",89)(8,"div",90)(9,"p")(10,"strong"),p(11,"Fecha:"),s(),p(12),s(),r(13,"p")(14,"strong"),p(15,"Hora:"),s(),p(16),s()(),r(17,"div",90)(18,"input",91,2),$("ngModelChange",function(e){h(n);let i=d();return V(i.patientSearchTerm,e)||(i.patientSearchTerm=e),x(e)}),v("input",function(){h(n);let e=d();return x(e.filterPatients())}),s()(),r(20,"div",92),y(21,Kt,11,11,"div",93)(22,Zt,2,0,"div",94),s()(),r(23,"div",95)(24,"button",96),v("click",function(){h(n);let e=d();return x(e.closeModal())}),p(25," Cancelar "),s(),r(26,"button",97),v("click",function(){h(n);let e=d();return x(e.createAppointment())}),y(27,te,2,0,"span",21)(28,ee,2,0,"span",21),s()()()()()}if(o&2){let n=d();z("display",n.showPatientModal?"block":"none"),D("show",n.showPatientModal),c(12),O(" ",n.formatDate(n.selectedDate)),c(4),O(" ",n.selectedTimeSlot),c(2),I("ngModel",n.patientSearchTerm),c(3),_("ngForOf",n.filteredPatients),c(),_("ngIf",n.filteredPatients.length===0),c(4),_("disabled",!n.selectedPatient||n.isCreatingAppointment),c(),_("ngIf",!n.isCreatingAppointment),c(),_("ngIf",n.isCreatingAppointment)}}function ie(o,m){if(o&1&&(r(0,"option",115),p(1),s()),o&2){let n=m.$implicit;_("value",n),c(),w(n)}}function oe(o,m){o&1&&(r(0,"span"),p(1,"Guardar Cambios"),s())}function ae(o,m){o&1&&(r(0,"span"),p(1,"Guardando..."),s())}function re(o,m){if(o&1){let n=k();r(0,"div",83)(1,"div",104)(2,"div",85)(3,"div",86)(4,"h5",87),p(5,"Editar Cita"),s(),r(6,"button",88),v("click",function(){h(n);let e=d();return x(e.closeModal())}),s()(),r(7,"div",89)(8,"div",90)(9,"label",105),p(10,"Paciente"),s(),r(11,"p",106),p(12),s()(),r(13,"div",90)(14,"label",105),p(15,"Fecha"),s(),r(16,"input",107),$("ngModelChange",function(e){h(n);let i=d();return V(i.editingDateLocal,e)||(i.editingDateLocal=e),x(e)}),s()(),r(17,"div",90)(18,"label",105),p(19,"Hora"),s(),r(20,"select",108),$("ngModelChange",function(e){h(n);let i=d();return V(i.editingTimeLocal,e)||(i.editingTimeLocal=e),x(e)}),y(21,ie,2,2,"option",109),s(),r(22,"div",110),p(23,"Horas permitidas: 09:00 - 22:00 en pasos de 30 minutos"),s()(),M(24,"div",90),r(25,"div",90)(26,"div",111)(27,"input",112),$("ngModelChange",function(e){h(n);let i=d();return V(i.editingPaid,e)||(i.editingPaid=e),x(e)}),s(),r(28,"label",113),p(29,"Pagada"),s()()()(),r(30,"div",95)(31,"button",114),v("click",function(){h(n);let e=d();return x(e.deleteAppointment(e.editingAppointment.id))})("touchstart",function(){h(n);let e=d();return x(e.deleteAppointment(e.editingAppointment.id))}),p(32," Eliminar "),s(),r(33,"button",96),v("click",function(){h(n);let e=d();return x(e.closeModal())}),p(34," Cancelar "),s(),r(35,"button",97),v("click",function(){h(n);let e=d();return x(e.updateAppointment())}),y(36,oe,2,0,"span",21)(37,ae,2,0,"span",21),s()()()()()}if(o&2){let n=d();z("display",n.showEditModal?"block":"none"),D("show",n.showEditModal),c(12),w(n.getPatientName(n.editingAppointment)),c(4),I("ngModel",n.editingDateLocal),c(4),I("ngModel",n.editingTimeLocal),c(),_("ngForOf",n.timeSlots),c(6),I("ngModel",n.editingPaid),c(8),_("disabled",n.isUpdatingAppointment),c(),_("ngIf",!n.isUpdatingAppointment),c(),_("ngIf",n.isUpdatingAppointment)}}function se(o,m){o&1&&M(0,"div",116)}var we=(()=>{let m=class m{isHoliday(t){let e=["01-01","12-25","08-15","05-01","10-12","11-01","12-06","12-08"],i=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0");return e.includes(`${i}-${a}`)}previousYear(){this.currentYear--}nextYear(){this.currentYear++}getMonthDaysOfYear(t,e){let i=[],a=new Date(t,e,1),l=new Date(t,e+1,0),g=a.getDay();g=g===0?6:g-1;for(let u=0;u<g;u++)i.push(null);for(let u=1;u<=l.getDate();u++)i.push(new Date(t,e,u));return i}isCurrentMonth(t,e){return t.getMonth()===e}getAppointmentPaymentStatus(t){if(t.creditRedemptions&&t.creditRedemptions.length>0){let e=t.creditRedemptions[0];if(e.creditPack&&typeof e.creditPack.paid<"u")return e.creditPack.paid?"paid":"pending"}return t.priceCents&&t.priceCents>0?"paid":null}set viewModeInput(t){t&&(this.viewMode=t)}getDayName(t){let e=[6,0,1,2,3,4,5];return this.weekDays[e[t]]}constructor(t,e,i,a,l,g){this.appointmentService=t,this.patientService=e,this.creditService=i,this.notificationService=a,this.router=l,this.eventBusService=g,this.currentYear=new Date().getFullYear(),this.currentDate=new Date,this.viewMode="month",this.hideHeader=!1,this.appointments=[],this.patients=[],this.filteredPatients=[],this.selectedDate=new Date,this.showPatientModal=!1,this.showEditModal=!1,this.selectedTimeSlot="",this.patientSearchTerm="",this.selectedPatient=null,this.proposedDuration=30,this.editingAppointment=null,this.editingStartLocal="",this.editingDateLocal="",this.editingTimeLocal="",this.editingPaid=!1,this.isCreatingAppointment=!1,this.isUpdatingAppointment=!1,this.timeSlots=[],this.weekDays=["Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b","Dom"],this.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.DEFAULT_PRICE_30=3e3,this.DEFAULT_PRICE_60=5500,this.generateTimeSlots()}exportMonthCsv(t,e,i="appointment"){return B(this,null,function*(){try{let a=e+1,l=`${Y.apiUrl}/reports/billing?year=${t}&month=${a}&groupBy=${i}`,g=yield fetch(l,{headers:{Accept:"text/csv","X-Tenant-Slug":Y.clientId}});if(!g.ok)throw new Error("Error generando CSV");let u=g.headers.get("Content-Type")||"";if(!u.includes("text/csv")&&!u.includes("application/csv")&&!u.includes("application/octet-stream")){let E=(yield g.text()).slice(0,1e3);console.error("CSV export returned unexpected Content-Type:",u,`
Preview:`,E),this.notificationService.showError("La exportaci\xF3n no devolvi\xF3 CSV. Revisa la consola para detalles.");return}let f=yield g.blob(),C=`facturas-${i}-${t}-${String(a).padStart(2,"0")}.csv`,b=document.createElement("a"),P=URL.createObjectURL(f);b.href=P,b.download=C,document.body.appendChild(b),b.click(),b.remove(),URL.revokeObjectURL(P)}catch(a){console.error("Error exporting CSV",a),this.notificationService.showError("Error al exportar CSV")}})}ngOnInit(){this.loadAppointments(),this.loadPatients(),this.eventBusService.packPaymentStatusChanged$.subscribe(t=>{console.log("Calendar: Pack payment status changed:",t),this.updateAppointmentPaymentStatus(t.packId,t.paid)})}generateTimeSlots(){this.timeSlots=[];for(let t=9;t<22;t++)for(let e=0;e<60;e+=30){let i=`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`;this.timeSlots.push(i)}}loadAppointments(){this.appointmentService.getAllAppointments().subscribe({next:t=>{this.appointments=t,this.appointments&&this.appointments.length>0?(console.info("[DEBUG] Primera cita cargada en CalendarComponent:",this.appointments[0]),console.info("[DEBUG] creditRedemptions:",JSON.stringify(this.appointments[0].creditRedemptions,null,2)),this.appointments[0].creditRedemptions&&this.appointments[0].creditRedemptions.length>0&&console.info("[DEBUG] creditPack del primer redemption:",JSON.stringify(this.appointments[0].creditRedemptions[0].creditPack,null,2))):console.info("[DEBUG] No hay citas cargadas en CalendarComponent")},error:t=>{this.notificationService.showError("Error al cargar las citas"),console.error("Error loading appointments:",t)}})}updateAppointmentPaymentStatus(t,e){console.log(`Updating payment status for pack ${t} to ${e}`),this.appointments.forEach(i=>{i.creditRedemptions&&i.creditRedemptions.forEach(a=>{a.creditPackId===t&&a.creditPack&&(a.creditPack.paid=e,console.log(`Updated appointment ${i.id} creditPack paid status to ${e}`))})})}loadPatients(){this.patientService.getPatients({limit:1e3}).subscribe({next:t=>{this.patients=t.patients,this.filteredPatients=t.patients},error:t=>{this.notificationService.showError("Error al cargar los pacientes"),console.error("Error loading patients:",t)}})}setViewMode(t){this.viewMode=t}previousPeriod(){switch(this.viewMode){case"month":this.currentDate.setMonth(this.currentDate.getMonth()-1);break;case"week":this.currentDate.setDate(this.currentDate.getDate()-7);break;case"day":this.currentDate.setDate(this.currentDate.getDate()-1);break}this.currentDate=new Date(this.currentDate)}nextPeriod(){switch(this.viewMode){case"month":this.currentDate.setMonth(this.currentDate.getMonth()+1);break;case"week":this.currentDate.setDate(this.currentDate.getDate()+7);break;case"day":this.currentDate.setDate(this.currentDate.getDate()+1);break}this.currentDate=new Date(this.currentDate)}goToToday(){this.currentDate=new Date}getMonthDays(){let t=this.currentDate.getFullYear(),e=this.currentDate.getMonth(),i=new Date(t,e,1),a=new Date(i),l=i.getDay(),g=l===0?6:l-1;a.setDate(a.getDate()-g);let u=[],f=new Date(a);for(let C=0;C<42;C++)u.push(new Date(f)),f.setDate(f.getDate()+1);return u}getWeekDays(){let t=new Date(this.currentDate),e=this.currentDate.getDay(),i=e===0?6:e-1;t.setDate(this.currentDate.getDate()-i);let a=[];for(let l=0;l<7;l++){let g=new Date(t);g.setDate(t.getDate()+l),a.push(g)}return a}isWeekend(t){let e=t.getDay();return e===0||e===6}isToday(t){let e=new Date;return t.toDateString()===e.toDateString()}getAppointmentsForDate(t){return this.appointments.filter(e=>new Date(e.start).toDateString()===t.toDateString())}getAppointmentForTimeSlot(t,e){let i=this.getAppointmentsForDate(t),[a,l]=e.split(":").map(Number),g=new Date(t);return g.setHours(a,l,0,0),i.find(f=>{let C=new Date(f.start),b=new Date(f.end);return g>=C&&g<b})||null}isAppointmentStart(t,e,i){if(!t)return!1;let[a,l]=i.split(":").map(Number),g=new Date(e);g.setHours(a,l,0,0);let u=new Date(t.start);return g.getTime()===u.getTime()}appointmentSpansMultipleSlots(t){if(!t||!t.start||!t.end)return!1;let e=new Date(t.start).getTime();return new Date(t.end).getTime()-e>1800*1e3}openCreateAppointmentModal(t,e){this.selectedDate=t,this.selectedTimeSlot=e,this.selectedPatient=null,this.patientSearchTerm="",this.loadPatients(),this.filteredPatients=[...this.patients],this.showPatientModal=!0,setTimeout(()=>{this.patientSearchInput&&this.patientSearchInput.nativeElement&&(this.patientSearchInput.nativeElement.focus(),this.patientSearchInput.nativeElement.click())},100)}selectPatient(t){this.selectedPatient=t,this.proposedDuration=30,t&&t.id&&this.creditService.getPatientCredits(t.id).subscribe({next:e=>{console.log("\u{1F4E6} Credits received:",e);let i=e.creditPacks||[],a=i.reduce((S,E)=>S+(Number(E.unitsRemaining)||0),0);this.selectedPatient&&(this.selectedPatient.activeSessions=a,console.log(`\u2705 activeSessions actualizado a ${a} para ${this.selectedPatient.firstName}`));let l=i.filter(S=>S.paid===!0&&S.unitsRemaining>0);console.log(`\u{1F4E6} Packs PAGADOS disponibles: ${l.length}`,l);let g=i.filter(S=>S.paid===!1&&S.unitsRemaining>0);console.log(`\u{1F4E6} Packs PENDIENTES disponibles: ${g.length}`,g);let u=null,f=!1;if(l.length>0?(u=l[0],f=!0):g.length>0&&(u=g[0],f=!1),!u){this.proposedDuration=30,console.log("\u26A0\uFE0F No hay packs disponibles, proponiendo 30min por defecto");return}let C=Number(u.unitMinutes),b=Number(u.unitsRemaining),P=f?"PAGADO":"PENDIENTE";console.log(`\u2705 Pack ${P} m\xE1s antiguo: ${u.label}, ${C}min, ${b} units disponibles`),C===60&&b>=2?(this.proposedDuration=60,console.log(`\u2705 Proponiendo 60min (pack ${P} de 60min con 2+ units)`)):(this.proposedDuration=30,console.log(`\u2705 Proponiendo 30min (pack ${P} de 30min o <2 units)`))},error:e=>{console.error("\u274C Error getting credits:",e),this.proposedDuration=30}})}hasTimeOverlap(t,e,i,a){return t<a&&e>i}checkAppointmentOverlap(t,e,i){for(let a of this.appointments){if(i&&a.id===i)continue;let l=new Date(a.start),g=new Date(a.end);if(this.hasTimeOverlap(t,e,l,g))return a}return null}createAppointment(){if(this.isCreatingAppointment){console.warn("\u26A0\uFE0F Ya se est\xE1 creando una cita, ignorando clic duplicado");return}if(this.isCreatingAppointment=!0,!this.selectedPatient){this.notificationService.showError("Selecciona un paciente"),this.isCreatingAppointment=!1;return}if((this.selectedPatient.activeSessions||0)<1){let b=confirm(`${this.selectedPatient.firstName} no tiene sesiones disponibles para agendar. \xBFDeseas crear un nuevo bono/sesi\xF3n?`);if(this.isCreatingAppointment=!1,b){this.router.navigate(["/pacientes",this.selectedPatient.id],{queryParams:{showCreditForm:"true"}});return}else return}let[i,a]=this.selectedTimeSlot.split(":").map(Number),l=new Date(this.selectedDate);l.setHours(i,a,0,0);let g=this.proposedDuration||30;console.log(`\u{1F550} Creating appointment with duration: ${g}min (proposedDuration=${this.proposedDuration})`);let u=new Date(l);u.setMinutes(u.getMinutes()+g);let f=this.checkAppointmentOverlap(l,u);if(f){let b=this.patients.find(E=>E.id===f.patientId),P=b?`${b.firstName} ${b.lastName}`:"Desconocido",S=this.formatTimeRange(f.start,f.end);this.notificationService.showError(`Ya existe una cita en ese horario: ${P} (${S}). Por favor, selecciona otro horario.`),this.isCreatingAppointment=!1;return}let C={patientId:this.selectedPatient.id,start:l.toISOString(),end:u.toISOString(),durationMinutes:g,consumesCredit:!0};console.log("\u{1F4CB} Appointment data:",C),this.appointmentService.createAppointment(C).subscribe({next:b=>{this.notificationService.showSuccess("Cita creada exitosamente"),this.closeModal(),this.loadPatients(),this.appointmentService.getAllAppointments().subscribe({next:P=>{this.appointments=P,this.isCreatingAppointment=!1,console.log("\u2705 Appointments reloaded, flag reset")},error:P=>{console.error("Error reloading appointments:",P),this.isCreatingAppointment=!1}})},error:b=>{this.notificationService.showError("Error al crear la cita"),console.error("Error creating appointment:",b),this.isCreatingAppointment=!1}})}openEditAppointmentModal(t){this.editingAppointment=t;let e=this.formatDateTimeLocal(t.start);if(e&&e.includes("T")){let[a,l]=e.split("T");this.editingDateLocal=a,this.editingTimeLocal=l,this.editingStartLocal=e}else this.editingDateLocal="",this.editingTimeLocal="",this.editingStartLocal="";this.showEditModal=!0;let i=this.getAppointmentPaymentStatus(t);this.editingPaid=i==="paid"}filterPatients(){if(!this.patientSearchTerm.trim()){this.filteredPatients=[...this.patients];return}let t=this.patientSearchTerm.toLowerCase();this.filteredPatients=this.patients.filter(e=>e.firstName.toLowerCase().includes(t)||e.lastName.toLowerCase().includes(t)||e.phone.includes(t)||e.email&&e.email.toLowerCase().includes(t))}updateAppointment(){if(!this.editingAppointment)return;if(this.isUpdatingAppointment){console.warn("\u26A0\uFE0F Ya se est\xE1 actualizando la cita, ignorando clic duplicado");return}this.isUpdatingAppointment=!0;let e=this.getAppointmentPaymentStatus(this.editingAppointment)==="paid",i=this.editingPaid!==e,a=this.formatDateTimeLocal(this.editingAppointment.start),l=`${this.editingDateLocal}T${this.editingTimeLocal}`;if(!(a!==l)&&i&&this.editingAppointment?.creditRedemptions?.length){let f=this.editingAppointment.creditRedemptions[0].creditPackId;console.log(`[DEBUG] ONLY payment status changed. Updating pack ${f} to ${this.editingPaid}`),this.creditService.updatePackPaymentStatus(f,this.editingPaid).subscribe({next:()=>{console.log("[DEBUG] Pack payment status updated successfully"),this.notificationService.showSuccess("Estado de pago actualizado exitosamente"),this.closeModal(),this.loadAppointments(),this.loadPatients(),this.isUpdatingAppointment=!1},error:C=>{console.error("Error updating payment status:",C),this.notificationService.showError("Error al actualizar estado de pago"),this.isUpdatingAppointment=!1}});return}let u={};if(this.editingDateLocal&&this.editingTimeLocal){let f=this.editingDateLocal,C=this.editingTimeLocal,[b,P]=C.split(":"),S=Number(b),E=Number(P),j=S*60+E;if(j<540||j>1290||E%30!==0){this.notificationService.showError("La hora debe estar entre 09:00 y 22:00 en pasos de 30 minutos"),this.isUpdatingAppointment=!1;return}let[vt,bt,wt]=f.split("-").map(T=>Number(T)),W=new Date(vt,Number(bt)-1,Number(wt),S,E,0,0);u.start=W.toISOString();let H=this.editingAppointment.durationMinutes&&Number(this.editingAppointment.durationMinutes)>0?Number(this.editingAppointment.durationMinutes):30,yt=new Date(W.getTime()+H*6e4);u.end=yt.toISOString(),u.durationMinutes=H;let Pt=new Date(u.start),St=new Date(u.end),N=this.checkAppointmentOverlap(Pt,St,this.editingAppointment.id);if(N){let T=this.patients.find(Ot=>Ot.id===N.patientId),Mt=T?`${T.firstName} ${T.lastName}`:"Desconocido",kt=this.formatTimeRange(N.start,N.end);this.notificationService.showError(`Ya existe una cita en ese horario: ${Mt} (${kt}). Por favor, selecciona otro horario.`),this.isUpdatingAppointment=!1;return}}if(this.editingAppointment.patientId!==void 0&&(u.patientId=this.editingAppointment.patientId),this.editingAppointment.consumesCredit!==void 0&&(u.consumesCredit=this.editingAppointment.consumesCredit),this.editingAppointment.notes!==void 0&&(u.notes=this.editingAppointment.notes===null?"":this.editingAppointment.notes),this.editingAppointment.status!==void 0&&(u.status=this.editingAppointment.status),console.info("[DEBUG] updateAppointment payload:",u),Object.keys(u).length===0){this.notificationService.showInfo("No hay cambios para guardar"),this.isUpdatingAppointment=!1;return}this.appointmentService.updateAppointment(this.editingAppointment.id,u).subscribe({next:f=>{if(i&&this.editingAppointment?.creditRedemptions?.length){let C=this.editingAppointment.creditRedemptions[0].creditPackId;console.log(`[DEBUG] Payment status also changed. Updating pack ${C} to ${this.editingPaid}`),this.creditService.updatePackPaymentStatus(C,this.editingPaid).subscribe({next:()=>{console.log("[DEBUG] Pack payment status updated successfully"),this.notificationService.showSuccess("Cita actualizada exitosamente"),this.closeModal(),this.loadAppointments(),this.loadPatients(),this.isUpdatingAppointment=!1},error:b=>{console.error("Error updating payment status:",b),this.notificationService.showError("Cita actualizada pero error al actualizar estado de pago"),this.closeModal(),this.loadAppointments(),this.loadPatients(),this.isUpdatingAppointment=!1}})}else this.notificationService.showSuccess("Cita actualizada exitosamente"),this.closeModal(),this.loadAppointments(),this.loadPatients(),this.isUpdatingAppointment=!1},error:f=>{console.error("Error updating appointment:",f),this.notificationService.showError("Error al actualizar la cita"),this.isUpdatingAppointment=!1}})}deleteAppointment(t){confirm("\xBFEst\xE1s seguro de que deseas eliminar esta cita?")&&this.appointmentService.deleteAppointment(t).subscribe({next:()=>{this.notificationService.showSuccess("Cita eliminada exitosamente"),this.closeModal(),this.loadAppointments(),this.loadPatients()},error:e=>{this.notificationService.showError("Error al eliminar la cita"),console.error("Error deleting appointment:",e)}})}closeModal(){this.showPatientModal=!1,this.showEditModal=!1,this.selectedPatient=null,this.editingAppointment=null,this.patientSearchTerm="",this.isCreatingAppointment=!1,this.isUpdatingAppointment=!1}getPatientName(t){let e=this.patients.find(i=>i.id===t.patientId);return e?`${e.firstName} ${e.lastName}`:"Paciente no encontrado"}formatDate(t){return t.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}formatTimeOnly(t){return new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}formatTimeRange(t,e){let i=this.formatTimeOnly(t),a=this.formatTimeOnly(e);return`${i} - ${a}`}getAppointmentOrigin(t){if(!t)return"";let e=t.creditRedemptions||[];if(e.length>0){let l=e[0].creditPack||{};if(l&&l.label){let C=String(l.label||"").trim();if(C)return C}let g=Number(l.unitsTotal??l.units_total??0),u=l.unitMinutes??l.unit_minutes??null,f=Number(u||0);if(f!==30&&f!==60&&(f=Number(t.durationMinutes||0)>=60?60:30),g>0)return g===1?`Sesi\xF3n ${f}m`:g===2?`Sesi\xF3n ${f}m`:`Bono ${f===60?Math.round(g/2):g}\xD7${f}m`}let i=Number(t.durationMinutes||0);return i>=60?"Sesi\xF3n 60m":i>0?`Sesi\xF3n ${i}m`:""}formatDateTimeLocal(t){if(!t)return"";let e=new Date(t),i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${i}-${a}-${l}T${g}:${u}`}appointmentPriceCents(t){if(!t||this.getAppointmentPaymentStatus(t)!=="paid")return 0;if(t.priceCents&&t.priceCents>0)return t.priceCents;let i=t.creditRedemptions||[];if(i.length>0){let l=i[0],g=l.creditPack||{},u=Number(g?.priceCents??g?.price_cents??g?.price??0)||0,f=Number(g?.unitsTotal??g?.units_total??0)||0,C=Number(l.unitsUsed||0);if(u>0&&f>0&&C>0)return Math.round(C*(u/f))}return Number(t.durationMinutes||0)>=60?this.DEFAULT_PRICE_60:this.DEFAULT_PRICE_30}getDayTotal(t){return t?(this.getAppointmentsForDate(t)||[]).reduce((i,a)=>i+this.appointmentPriceCents(a),0):0}getWeekTotal(){let t=this.getWeekDays(),e=0;return t.forEach(i=>{e+=this.getDayTotal(i)}),e}getMonthTotal(t,e){let i=0;return this.appointments.forEach(a=>{if(!a||!a.start)return;let l=new Date(a.start);l.getFullYear()===t&&l.getMonth()===e&&(i+=this.appointmentPriceCents(a))}),i}formatPriceCents(t){return t?(t/100).toFixed(t%100===0?0:2).replace(".",",")+" \u20AC":""}getMinForDate(t){let e=t?new Date(t):new Date,i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${i}-${a}-${l}T09:00`}getMaxForDate(t){let e=t?new Date(t):new Date,i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${i}-${a}-${l}T22:00`}getTimeUntil(t){let e=new Date,i=new Date(t),a=Math.floor((i.getTime()-e.getTime())/(1e3*60));if(a<60)return`${a} min`;{let l=Math.floor(a/60),g=a%60;return`${l}h ${g}m`}}};m.\u0275fac=function(e){return new(e||m)(A(ft),A(_t),A(ht),A(xt),A(rt),A(Ct))},m.\u0275cmp=G({type:m,selectors:[["app-calendar"]],viewQuery:function(e,i){if(e&1&&Q(Dt,5),e&2){let a;X(a=K())&&(i.patientSearchInput=a.first)}},inputs:{viewModeInput:"viewModeInput",hideHeader:"hideHeader"},decls:10,vars:8,consts:[["occupiedSlot",""],["emptySlot",""],["patientSearchInput",""],[1,"calendar-container"],[1,"calendar-header"],["class","d-flex justify-content-between align-items-center mb-3",4,"ngIf"],["class","d-flex justify-content-between align-items-center mb-4",4,"ngIf"],["class","year-view",4,"ngIf"],["class","week-view",4,"ngIf"],["class","day-view",4,"ngIf"],["class","modal fade","tabindex","-1","role","dialog",3,"show","display",4,"ngIf"],["class","modal-backdrop fade show",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],["role","group",1,"btn-group"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-chevron-left"],[1,"calendar-title","mb-0"],[4,"ngIf"],[1,"btn","btn-outline-primary",3,"click"],[1,"fas","fa-chevron-right"],[1,"text-muted","ms-2"],[1,"year-view"],[1,"d-flex","justify-content-center","align-items-center","mb-3"],[1,"btn","btn-outline-secondary","me-2",3,"click"],[1,"btn","btn-outline-secondary","ms-2",3,"click"],[1,"year-months-grid-compact"],["class","month-block-compact",4,"ngFor","ngForOf"],[1,"month-block-compact"],[1,"text-center","mb-1"],[1,"text-muted"],["aria-label","Exportar facturas por cita","title","Exportar facturas por cita (una factura por cada cita)",1,"btn","btn-sm","btn-outline-success","ms-2",2,"padding",".12rem .12rem","font-size","0.6rem","width","1.2rem","height","1.2rem","display","inline-flex","align-items","center","justify-content","center",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","14","height","14","viewBox","0 0 16 16","fill","currentColor","aria-hidden","true"],["d","M4 1.5A1.5 1.5 0 0 0 2.5 3v10A1.5 1.5 0 0 0 4 14.5h8a1.5 1.5 0 0 0 1.5-1.5V5.707A1 1 0 0 0 12.793 5L9 1.207A1 1 0 0 0 8.293 1H4zM9 2.5L12.5 6H9V2.5z"],["d","M5.2 9.2l.9-1 1 1 .9-1 .9 1-.9 1 1 1-.9 1-1-1-1 1-.9-1 1-1-.9-1z"],["aria-label","Exportar facturas por paciente","title","Exportar facturas por paciente (una factura por cada paciente agrupando sus citas)",1,"btn","btn-sm","btn-outline-secondary","ms-1",2,"padding",".12rem .12rem","font-size","0.6rem","width","1.2rem","height","1.2rem","display","inline-flex","align-items","center","justify-content","center",3,"click"],["d","M3 2.5A1.5 1.5 0 0 1 4.5 1h6A1.5 1.5 0 0 1 12 2.5V4h1.5A1.5 1.5 0 0 1 15 5.5V13A1.5 1.5 0 0 1 13.5 14.5h-11A1.5 1.5 0 0 1 1 13V5.5A1.5 1.5 0 0 1 2.5 4H3V2.5zM5.5 7.5l.7-.7.8.8.8-.8.7.7-.8.8.8.8-.7.7-.8-.8-.8.8-.7-.7.8-.8-.8-.8z"],[1,"calendar-grid-compact"],["class","day-header-compact",4,"ngFor","ngForOf"],["class","calendar-day-compact",3,"has-appointments-compact","holiday-compact","weekend-compact","click",4,"ngFor","ngForOf"],[1,"day-header-compact"],[1,"calendar-day-compact",3,"click"],[1,"day-number-compact"],[1,"week-view"],[1,"week-grid"],[1,"time-column"],["class","day-column-header",3,"weekend","today",4,"ngFor","ngForOf"],["class","time-row",4,"ngFor","ngForOf"],[1,"day-column-header"],[1,"day-name"],[1,"day-date"],[1,"time-row"],[1,"time-label"],["class","time-slot",3,"weekend","click",4,"ngFor","ngForOf"],[1,"time-slot",3,"click"],[3,"ngClass","click",4,"ngIf"],[3,"click","ngClass"],[4,"ngIf","ngIfElse"],[1,"appointment-content"],[1,"appointment-name"],[1,"small","text-muted","appointment-time"],[1,"appointment-origin"],[1,"appointment-continued-content","appointment-content"],[1,"day-view"],[1,"day-schedule"],[1,"time-slots"],["class","time-slot-row",3,"click",4,"ngFor","ngForOf"],[1,"time-slot-row",3,"click"],[1,"slot-content"],["class","appointment-card",3,"ngClass","click",4,"ngIf","ngIfElse"],[1,"appointment-card",3,"click","ngClass"],[1,"d-flex","justify-content-between","align-items-start"],[1,"text-muted","small"],[1,"appointment-actions"],[1,"btn","btn-sm","btn-outline-primary","me-1",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],[1,"empty-slot"],[1,"fas","fa-plus","text-muted"],["tabindex","-1","role","dialog",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],["type","text","placeholder","Buscar paciente por nombre, tel\xE9fono o email...","autofocus","","tabindex","0",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"patient-list",2,"max-height","400px","overflow-y","auto","-webkit-overflow-scrolling","touch"],["class","patient-card","style","touch-action: manipulation; cursor: pointer;",3,"selected","click","touchstart",4,"ngFor","ngForOf"],["class","text-center text-muted py-3",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",2,"touch-action","manipulation","min-height","44px",3,"click"],["type","button",1,"btn","btn-primary",2,"touch-action","manipulation","min-height","44px",3,"click","disabled"],[1,"patient-card",2,"touch-action","manipulation","cursor","pointer",3,"click","touchstart"],[1,"d-flex","justify-content-between","align-items-center"],["class","text-muted small",4,"ngIf"],[1,"text-end"],[1,"badge"],[1,"text-center","text-muted","py-3"],["role","document",1,"modal-dialog"],[1,"form-label"],[1,"form-control-plaintext"],["type","date","tabindex","0",1,"form-control",2,"min-height","44px",3,"ngModelChange","ngModel"],["tabindex","0",1,"form-select",2,"min-height","44px",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"form-text"],[1,"form-check",2,"min-height","44px","display","flex","align-items","center"],["type","checkbox","id","editingPaid","tabindex","0",1,"form-check-input",2,"width","24px","height","24px","cursor","pointer",3,"ngModelChange","ngModel"],["for","editingPaid",1,"form-check-label",2,"margin-left","10px","cursor","pointer","padding","10px"],["type","button",1,"btn","btn-danger","me-auto",2,"touch-action","manipulation","min-height","44px",3,"click","touchstart"],[3,"value"],[1,"modal-backdrop","fade","show"]],template:function(e,i){e&1&&(r(0,"div",3)(1,"div",4),y(2,Tt,10,6,"div",5)(3,$t,12,2,"div",6),s(),y(4,Ut,10,2,"div",7)(5,Bt,5,2,"div",8)(6,Qt,4,1,"div",9),s(),y(7,ne,29,12,"div",10)(8,re,38,12,"div",10)(9,se,1,0,"div",11)),e&2&&(c(2),_("ngIf",!i.hideHeader),c(),_("ngIf",!i.hideHeader&&i.viewMode!=="month"),c(),_("ngIf",i.viewMode==="month"),c(),_("ngIf",i.viewMode==="week"),c(),_("ngIf",i.viewMode==="day"),c(),_("ngIf",i.showPatientModal),c(),_("ngIf",i.showEditModal&&i.editingAppointment),c(),_("ngIf",i.showPatientModal||i.showEditModal))},dependencies:[at,nt,it,ot,ut,mt,gt,ct,st,pt,dt,lt],styles:['@charset "UTF-8";.calendar-day-compact.holiday-compact[_ngcontent-%COMP%]{background:#ffb3b3;color:#b71c1c;border:1px solid #b71c1c}.year-months-grid-compact[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}.month-block-compact[_ngcontent-%COMP%]{background:#fff;border-radius:6px;box-shadow:0 1px 2px #00000012;padding:8px 4px}.calendar-grid-compact[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:1px}.day-header-compact[_ngcontent-%COMP%]{background:#495057;color:#fff;padding:2px 0;text-align:center;font-size:10px;font-weight:600}.calendar-day-compact[_ngcontent-%COMP%]{background:#fff;min-height:18px;height:18px;padding:0;cursor:pointer;font-size:10px;text-align:center;border-radius:3px;transition:background-color .2s}.calendar-day-compact[_ngcontent-%COMP%]:hover{background:#e3f2fd}.calendar-day-compact.weekend-compact[_ngcontent-%COMP%]{background:#ffe0b2}.calendar-day-compact.has-appointments-compact[_ngcontent-%COMP%]{background:#bbdefb;border:1px solid #2196f3;color:#1565c0}.day-number-compact[_ngcontent-%COMP%]{font-weight:500}.calendar-day.has-appointments[_ngcontent-%COMP%]{background-color:#e3f2fd;border:1px solid #90caf9}.calendar-container[_ngcontent-%COMP%]{padding:20px;background:#f8f9fa;min-height:100vh}.calendar-header[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px}.calendar-title[_ngcontent-%COMP%]{color:#2c3e50;font-weight:600}.month-view[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;overflow:hidden}.calendar-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:1px;background:#dee2e6}.day-header[_ngcontent-%COMP%]{background:#495057;color:#fff;padding:15px 10px;text-align:center;font-weight:600;font-size:14px}.calendar-day[_ngcontent-%COMP%]{background:#fff;min-height:120px;padding:8px;cursor:pointer;transition:background-color .2s;display:flex;flex-direction:column}.calendar-day[_ngcontent-%COMP%]:hover{background:#f8f9fa}.calendar-day.other-month[_ngcontent-%COMP%]{background:#f8f9fa;color:#6c757d}.calendar-day.weekend[_ngcontent-%COMP%]{background:#fff3cd}.calendar-day.weekend.other-month[_ngcontent-%COMP%]{background:beige}.calendar-day.today[_ngcontent-%COMP%]{background:#e3f2fd;border:2px solid #2196f3}.calendar-day.today[_ngcontent-%COMP%]:not(.weekend){background:#fff;border:1px solid #dee2e6}.day-number[_ngcontent-%COMP%]{font-weight:600;margin-bottom:5px;color:#2c3e50}.day-appointments[_ngcontent-%COMP%]{flex:1;overflow:hidden}.appointment-item[_ngcontent-%COMP%]{background:#007bff;color:#fff;padding:2px 6px;margin-bottom:2px;border-radius:3px;font-size:11px;cursor:pointer;transition:background-color .2s}.appointment-item[_ngcontent-%COMP%]:hover{background:#0056b3}.week-view[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;overflow:hidden}.week-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:80px repeat(7,1fr);gap:1px;background:#dee2e6}.time-column[_ngcontent-%COMP%]{background:#495057}.day-column-header[_ngcontent-%COMP%]{background:#495057;color:#fff;padding:15px 10px;text-align:center}.day-column-header.weekend[_ngcontent-%COMP%]{background:#fd7e14}.day-column-header[_ngcontent-%COMP%]:not(.weekend){background:#6c757d;color:#fff}.day-column-header.today[_ngcontent-%COMP%]{background:#007bff}.day-column-header.today[_ngcontent-%COMP%]:not(.weekend){background:#6c757d;color:#fff}.day-column-header.today.weekend[_ngcontent-%COMP%]{background:#007bff}.day-name[_ngcontent-%COMP%]{font-weight:600;font-size:14px}.day-date[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-top:5px}.time-row[_ngcontent-%COMP%]{display:contents}.time-label[_ngcontent-%COMP%]{background:#f8f9fa;padding:15px 10px;text-align:center;font-size:12px;font-weight:500;border-right:1px solid #dee2e6;display:flex;align-items:center;justify-content:center}.time-slot[_ngcontent-%COMP%]{background:#fff;min-height:40px;cursor:pointer;transition:background-color .2s;position:relative;display:flex;align-items:center;padding:5px}.time-slot[_ngcontent-%COMP%]:hover{background:#f8f9fa}.time-slot.weekend[_ngcontent-%COMP%]{background:#fff3cd}.time-slot[_ngcontent-%COMP%]:not(.weekend){background:#fff}.time-slot[_ngcontent-%COMP%]:not(.weekend):hover{background:#f8f9fa}.appointment-block[_ngcontent-%COMP%]{background:#007bff;color:#fff;padding:5px 8px;border-radius:4px;font-size:12px;width:100%;text-align:center;cursor:pointer;transition:background-color .2s}.time-slot[_ngcontent-%COMP%]{position:relative}.appointment-block[_ngcontent-%COMP%]{position:absolute;left:6px;right:6px;top:6px;box-sizing:border-box;z-index:2;height:calc(100% - 12px);border-radius:4px;display:flex;align-items:center;justify-content:center;padding:0 6px}.appointment-block[_ngcontent-%COMP%], .appointment-block-continued[_ngcontent-%COMP%], .appointment-continued-content[_ngcontent-%COMP%]{font-size:12px;line-height:1.2;white-space:normal;word-break:break-word;overflow:hidden;padding-top:4px}.appointment-block[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .appointment-block-continued[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .appointment-continued-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:12px;font-weight:600}.appointment-block[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%], .appointment-block-continued[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%], .appointment-continued-content[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px}.appointment-block[_ngcontent-%COMP%], .appointment-block-continued[_ngcontent-%COMP%]{overflow:hidden;white-space:normal}.appointment-block[_ngcontent-%COMP%]:hover{background:#0056b3}.appointment-block-continued[_ngcontent-%COMP%]{position:absolute;left:6px;right:6px;top:6px;box-sizing:border-box;z-index:2;height:calc(100% - 12px);border-radius:4px;display:flex;align-items:center;justify-content:center;padding:0 6px}.appointment-continued-content[_ngcontent-%COMP%]{width:100%;text-align:center}.appointment-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;width:100%}.appointment-origin[_ngcontent-%COMP%]{position:absolute;right:6px;bottom:4px;font-size:10px;opacity:0;background:#ffffffe6;padding:2px 6px;border-radius:3px;pointer-events:none;transition:opacity .2s ease;color:#495057}.appointment-block[_ngcontent-%COMP%]:hover   .appointment-origin[_ngcontent-%COMP%], .appointment-block[_ngcontent-%COMP%]:hover   .appointment-continued-content[_ngcontent-%COMP%]   .appointment-origin[_ngcontent-%COMP%]{opacity:1}.appointment-origin-card[_ngcontent-%COMP%]{position:absolute;right:10px;bottom:8px;font-size:11px;color:#495057;background:#ffffffe6;padding:2px 6px;border-radius:4px;pointer-events:none;opacity:1}.appointment-name[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:600;line-height:1.1}.appointment-time[_ngcontent-%COMP%]{display:block;font-size:11px;line-height:1.1;color:#ffffffe6}.day-view[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;padding:20px}.day-schedule[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#2c3e50;border-bottom:2px solid #007bff;padding-bottom:10px}.time-slots[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto}.time-slot-row[_ngcontent-%COMP%]{display:flex;align-items:stretch;border-bottom:1px solid #e9ecef;min-height:60px;cursor:pointer;transition:background-color .2s}.time-slot-row[_ngcontent-%COMP%]:hover{background:#f8f9fa}.time-slot-row[_ngcontent-%COMP%]   .time-label[_ngcontent-%COMP%]{width:100px;background:#f8f9fa;display:flex;align-items:center;justify-content:center;font-weight:500;font-size:14px;border-right:2px solid #dee2e6}.slot-content[_ngcontent-%COMP%]{flex:1;padding:10px 15px;display:flex;align-items:center}.appointment-card[_ngcontent-%COMP%]{background:#e3f2fd;border:1px solid #2196f3;border-radius:6px;padding:12px;width:100%;cursor:pointer;transition:all .2s}.appointment-card[_ngcontent-%COMP%]:hover{background:#bbdefb;transform:translateY(-1px);box-shadow:0 4px 8px #0000001a}.appointment-card[_ngcontent-%COMP%]:hover   .appointment-origin[_ngcontent-%COMP%]:not(.appointment-origin-card){opacity:1}.appointment-actions[_ngcontent-%COMP%]{display:flex;gap:5px}.empty-slot[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;opacity:.6;transition:opacity .2s}.time-slot-row[_ngcontent-%COMP%]:hover   .empty-slot[_ngcontent-%COMP%]{opacity:1}.modal.show[_ngcontent-%COMP%]{background:#00000080}.patient-card[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:6px;padding:12px;margin-bottom:8px;cursor:pointer;transition:all .2s;touch-action:manipulation;-webkit-tap-highlight-color:rgba(0,123,255,.2);min-height:60px;display:flex;align-items:center}.patient-card[_ngcontent-%COMP%]:hover, .patient-card[_ngcontent-%COMP%]:active{border-color:#007bff;background:#f8f9fa}.patient-card.selected[_ngcontent-%COMP%]{border-color:#007bff;background:#e3f2fd}@media (max-width: 768px){.modal-dialog[_ngcontent-%COMP%]{margin:.5rem;max-width:calc(100% - 1rem)}.patient-card[_ngcontent-%COMP%]{padding:18px;min-height:70px;font-size:16px}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.modal-footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:12px 20px;font-size:16px;min-height:44px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{font-size:16px;padding:12px;min-height:44px}.patient-list[_ngcontent-%COMP%]{-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.calendar-container[_ngcontent-%COMP%]{padding:10px}.calendar-header[_ngcontent-%COMP%]{padding:15px}.calendar-grid[_ngcontent-%COMP%]{font-size:12px}.calendar-day[_ngcontent-%COMP%]{min-height:80px;padding:4px}.appointment-item[_ngcontent-%COMP%]{font-size:10px;padding:1px 4px}.week-grid[_ngcontent-%COMP%]{grid-template-columns:60px repeat(7,1fr)}.time-label[_ngcontent-%COMP%]{padding:10px 5px;font-size:10px}.time-slot[_ngcontent-%COMP%]{min-height:30px;padding:2px}.appointment-block[_ngcontent-%COMP%]{font-size:10px;padding:3px 5px}.day-view[_ngcontent-%COMP%]{padding:15px}.time-slot-row[_ngcontent-%COMP%]   .time-label[_ngcontent-%COMP%]{width:70px;font-size:12px}.slot-content[_ngcontent-%COMP%]{padding:8px 10px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.appointment-item[_ngcontent-%COMP%], .appointment-block[_ngcontent-%COMP%], .appointment-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.appointment-block.status-pending[_ngcontent-%COMP%], .appointment-item.status-pending[_ngcontent-%COMP%], .appointment-card.status-pending[_ngcontent-%COMP%]{background-color:#ffc107!important;color:#212529!important;border:1px solid #ffc107!important}.appointment-block.status-paid[_ngcontent-%COMP%], .appointment-item.status-paid[_ngcontent-%COMP%], .appointment-card.status-paid[_ngcontent-%COMP%]{background-color:#0d6efd!important;color:#fff!important;border:1px solid #0d6efd!important}.btn-group[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff;color:#fff}.appointment-item.cancelled[_ngcontent-%COMP%], .appointment-block.cancelled[_ngcontent-%COMP%], .appointment-card.cancelled[_ngcontent-%COMP%]{background:#dc3545!important;opacity:.7;text-decoration:line-through}.appointment-item.no-show[_ngcontent-%COMP%], .appointment-block.no-show[_ngcontent-%COMP%], .appointment-card.no-show[_ngcontent-%COMP%]{background:#ffc107!important;color:#000;opacity:.8}.time-slots[_ngcontent-%COMP%]::-webkit-scrollbar, .patient-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.time-slots[_ngcontent-%COMP%]::-webkit-scrollbar-track, .patient-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.time-slots[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .patient-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.time-slots[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .patient-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.calendar-header[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:40px;height:38px;display:flex;align-items:center;justify-content:center}']});let o=m;return o})();export{we as a};
