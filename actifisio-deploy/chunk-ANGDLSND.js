import{a as Z}from"./chunk-TMQD5YC6.js";import{a as X}from"./chunk-4IIHAL6L.js";import{b as A,c as g,d as z,e as L,h as U,i as q,j as R,k as H,p as G,t as K,u as Y,v as J,x as W,y as Q}from"./chunk-IEVIATPJ.js";import{$a as D,Ea as B,Ia as f,P as M,T as F,Ub as O,Va as p,Vb as I,Wa as i,Xa as r,Xb as V,Ya as c,Z as k,_ as S,a as P,ab as b,b as T,bb as v,bc as $,dc as j,hb as x,ib as w,jb as o,jc as N,kb as _,lb as h,ua as a,ya as y}from"./chunk-X7ILVH5W.js";var ee=(()=>{let m=class m{constructor(e,n){this.http=e,this.clientConfig=n,this.apiUrl=`${this.clientConfig.getApiUrl()}/backup`,this.httpOptions={headers:new $(P({"Content-Type":"application/json"},this.clientConfig.getTenantHeader()))}}getBackups(){return this.http.get(`${this.apiUrl}/list`,this.httpOptions)}getBackupsByDate(){return this.http.get(`${this.apiUrl}/grouped`,this.httpOptions)}createBackup(){return this.http.post(`${this.apiUrl}/create`,{},this.httpOptions)}getBackupStats(){return this.http.get(`${this.apiUrl}/stats`,this.httpOptions)}restoreBackup(e){return this.http.post(`${this.apiUrl}/restore/${e}`,{},this.httpOptions)}downloadBackup(e){return this.http.get(`${this.apiUrl}/download/${e}`,T(P({},this.httpOptions),{responseType:"blob"}))}deleteBackup(e){return this.http.delete(`${this.apiUrl}/delete/${e}`,this.httpOptions)}getBackupStatus(){return this.http.get(`${this.apiUrl}/status`,this.httpOptions)}};m.\u0275fac=function(n){return new(n||m)(F(j),F(N))},m.\u0275prov=M({token:m,factory:m.\u0275fac,providedIn:"root"});let s=m;return s})();function ae(s,m){s&1&&(i(0,"div",92),o(1," El nombre es requerido "),r())}function se(s,m){s&1&&(i(0,"div",92),o(1," Email inv\xE1lido "),r())}function ce(s,m){s&1&&c(0,"span",93)}function le(s,m){s&1&&c(0,"i",94)}function de(s,m){s&1&&c(0,"span",93)}function ue(s,m){s&1&&c(0,"span",95)}function me(s,m){s&1&&c(0,"i",96)}function pe(s,m){s&1&&c(0,"span",95)}function ge(s,m){s&1&&c(0,"i",97)}function be(s,m){if(s&1&&(i(0,"div",98)(1,"div",99)(2,"div",100)(3,"div",101),c(4,"i",102),i(5,"h5",103),o(6),r(),i(7,"small"),o(8,"Total de backups"),r()()()(),i(9,"div",99)(10,"div",104)(11,"div",101),c(12,"i",105),i(13,"h5",103),o(14),r(),i(15,"small"),o(16,"\xDAltimo backup"),r()()()(),i(17,"div",99)(18,"div",106)(19,"div",101),c(20,"i",107),i(21,"h5",103),o(22),r(),i(23,"small"),o(24,"Espacio Usado"),r()()()(),i(25,"div",99)(26,"div",108)(27,"div",101),c(28,"i",109),i(29,"h5",103),o(30),r(),i(31,"small"),o(32,"Pr\xF3ximo Autom\xE1tico"),r()()()()()),s&2){let u=v();a(6),_(u.backupStats.totalBackups),a(8),_(u.formatDate(u.backupStats.lastBackup)),a(8),_(u.backupStats.totalSize),a(8),_(u.formatDate(u.backupStats.nextScheduled))}}function fe(s,m){s&1&&(i(0,"div",110)(1,"div",111)(2,"span",112),o(3,"Cargando..."),r()(),i(4,"p",113),o(5,"Cargando backups..."),r()())}function he(s,m){s&1&&(i(0,"div",110),c(1,"i",114),i(2,"h6",115),o(3,"No hay backups disponibles"),r(),i(4,"p",35),o(5,"Crea tu primer backup usando el bot\xF3n superior"),r()())}function ve(s,m){s&1&&(i(0,"span",81),c(1,"i",136),o(2," Actual "),r())}function _e(s,m){if(s&1){let u=D();i(0,"div",121)(1,"div",122)(2,"div",123)(3,"div",124)(4,"span",125),o(5),r(),f(6,ve,3,0,"span",126),r(),i(7,"h6",127),o(8),r(),i(9,"div",128)(10,"div"),c(11,"i",129),o(12),r(),i(13,"div"),c(14,"i",48),o(15),r()(),i(16,"div",130)(17,"button",131),b("click",function(){let n=k(u).$implicit,t=v(3);return S(t.downloadBackup(n))}),c(18,"i",132),r(),i(19,"button",133),b("click",function(){let n=k(u).$implicit,t=v(3);return S(t.confirmRestore(n))}),c(20,"i",87),r(),i(21,"button",134),b("click",function(){let n=k(u).$implicit,t=v(3);return S(t.confirmDelete(n))}),c(22,"i",135),r()()()()()}if(s&2){let u=m.$implicit,e=m.index,n=v(3);a(),x("border-success",e===0&&n.isFirstOverall(u))("border-2",e===0&&n.isFirstOverall(u)),a(3),w(n.getBackupTypeBadgeClass(u.type)),a(),h(" ",n.getBackupTypeLabel(u.type)," "),a(),p("ngIf",e===0&&n.isFirstOverall(u)),a(2),h(" ",n.formatTime(u.created)," "),a(4),h("",u.size," "),a(3),_(n.getRelativeTime(u.created)),a(4),p("disabled",n.isFirstOverall(u)),a(2),p("disabled",n.isFirstOverall(u))}}function xe(s,m){if(s&1&&(i(0,"div",117)(1,"h6",118),c(2,"i",119),o(3),r(),i(4,"div",1),f(5,_e,23,13,"div",120),r()()),s&2){let u=m.$implicit;a(3),h(" ",u.date," "),a(2),p("ngForOf",u.backups)}}function Ce(s,m){if(s&1&&(i(0,"div"),f(1,xe,6,2,"div",116),r()),s&2){let u=v();a(),p("ngForOf",u.objectValues(u.backupsByDate))}}function ke(s,m){s&1&&(i(0,"span",151),o(1,"Actual"),r())}function Se(s,m){if(s&1){let u=D();i(0,"tr")(1,"td")(2,"div",142)(3,"span",143),o(4),r(),i(5,"small",35),o(6),r()()(),i(7,"td")(8,"div",77)(9,"span",144),o(10),r(),f(11,ke,2,0,"span",145),r()(),i(12,"td")(13,"span",146),o(14),r()(),i(15,"td")(16,"span",125),o(17),r()(),i(18,"td",140)(19,"div",147)(20,"button",148),b("click",function(){let n=k(u).$implicit,t=v(2);return S(t.downloadBackup(n))}),c(21,"i",132),r(),i(22,"button",149),b("click",function(){let n=k(u).$implicit,t=v(2);return S(t.confirmRestore(n))}),c(23,"i",87),r(),i(24,"button",150),b("click",function(){let n=k(u).$implicit,t=v(2);return S(t.confirmDelete(n))}),c(25,"i",135),r()()()()}if(s&2){let u=m.$implicit,e=m.index,n=v(2);x("table-success",e===0),a(4),_(n.formatDate(u.created)),a(2),_(n.getRelativeTime(u.created)),a(4),_(u.displayName),a(),p("ngIf",e===0),a(3),_(u.size),a(2),w(n.getBackupTypeBadgeClass(u.type)),a(),h(" ",n.getBackupTypeLabel(u.type)," "),a(5),p("disabled",e===0),a(2),p("disabled",e===0)}}function ye(s,m){if(s&1&&(i(0,"div",137)(1,"table",138)(2,"thead",139)(3,"tr")(4,"th"),o(5,"\u{1F4C5} Fecha"),r(),i(6,"th"),o(7,"\u{1F4C1} Nombre"),r(),i(8,"th"),o(9,"\u{1F4CF} Tama\xF1o"),r(),i(10,"th"),o(11,"\u{1F550} Tipo"),r(),i(12,"th",140),o(13,"\u26A1 Acciones"),r()()(),i(14,"tbody"),f(15,Se,26,12,"tr",141),r()()()),s&2){let u=v();a(15),p("ngForOf",u.backups)}}function Ee(s,m){s&1&&(i(0,"div",152)(1,"div",140)(2,"div",111)(3,"span",112),o(4,"Cargando..."),r()(),i(5,"p",115),o(6,"Cargando configuraci\xF3n..."),r()()())}var Ne=(()=>{let m=class m{constructor(e,n,t,l,d,C){this.fb=e,this.configService=n,this.notificationService=t,this.backupService=l,this.patientService=d,this.utils=C,this.loading=!1,this.saving=!1,this.loadingPrices=!1,this.backups=[],this.backupsByDate={},this.backupStats=null,this.loadingBackups=!1,this.creatingBackup=!1,this.exportingPatients=!1,this.viewMode="grouped",this.activeTab="clinic",this.configuration=null,this.weekDays=[{key:"monday",label:"Lunes"},{key:"tuesday",label:"Martes"},{key:"wednesday",label:"Mi\xE9rcoles"},{key:"thursday",label:"Jueves"},{key:"friday",label:"Viernes"},{key:"saturday",label:"S\xE1bado"},{key:"sunday",label:"Domingo"}],this.clinicForm=this.createClinicForm(),this.schedulingForm=this.createSchedulingForm(),this.pricesForm=this.createPricesForm()}ngOnInit(){this.loadConfiguration(),this.loadBackupData()}switchToPricesTab(){console.log("\u{1F3F7}\uFE0F Cambiando a pesta\xF1a de Precios"),this.activeTab="prices",this.loadPrices()}createClinicForm(){return this.fb.group({name:["",[g.required,g.minLength(2)]],address:["",g.required],phone:["",[g.required,g.pattern(/^\+?[\d\s\-\(\)]+$/)]],email:["",[g.required,g.email]]})}createSchedulingForm(){let e={};return this.weekDays.forEach(n=>{e[n.key]=this.fb.group({enabled:[!1],morning:this.fb.group({start:["09:00"],end:["13:00"]}),afternoon:this.fb.group({start:["15:00"],end:["19:00"]})})}),this.fb.group({defaultDuration:[30,[g.required,g.min(15),g.max(120)]],slotDuration:[30,[g.required,g.min(15),g.max(60)]],workingHours:this.fb.group(e)})}createPricesForm(){return this.fb.group({sessionPrice30:[25,[g.required,g.min(0)]],sessionPrice60:[45,[g.required,g.min(0)]],bonoPrice30:[100,[g.required,g.min(0)]],bonoPrice60:[180,[g.required,g.min(0)]]})}loadConfiguration(){this.loading=!0,this.configService.getConfiguration().subscribe({next:e=>{this.configuration=e,this.populateForms(e),this.loading=!1},error:e=>{console.error("Error loading configuration:",e),this.notificationService.showError("Error al cargar la configuraci\xF3n"),this.loading=!1}})}populateForms(e){if(e.clinicInfo&&this.clinicForm.patchValue(e.clinicInfo),this.schedulingForm.patchValue({defaultDuration:e.defaultDuration,slotDuration:e.slotDuration}),e.workingHours){let n=this.schedulingForm.get("workingHours");n&&Object.keys(e.workingHours).forEach(t=>{let l=e.workingHours[t],d=n.get(t);d&&l&&d.patchValue(l)})}}saveClinicInfo(){if(this.clinicForm.valid){this.saving=!0;let n={clinicInfo:this.clinicForm.value};this.configService.updateConfiguration(n).subscribe({next:t=>{this.configuration=t,this.notificationService.showSuccess("Informaci\xF3n de la cl\xEDnica actualizada"),this.saving=!1},error:t=>{console.error("Error updating clinic info:",t),this.notificationService.showError("Error al actualizar la informaci\xF3n"),this.saving=!1}})}}saveSchedulingConfig(){if(this.schedulingForm.valid){this.saving=!0;let e=this.schedulingForm.value,n={defaultDuration:e.defaultDuration,slotDuration:e.slotDuration,workingHours:e.workingHours};this.configService.updateConfiguration(n).subscribe({next:t=>{this.configuration=t,this.notificationService.showSuccess("Configuraci\xF3n de horarios actualizada"),this.saving=!1},error:t=>{console.error("Error updating scheduling config:",t),this.notificationService.showError("Error al actualizar los horarios"),this.saving=!1}})}}resetConfiguration(){confirm("\xBFEst\xE1s seguro de que quieres restablecer toda la configuraci\xF3n?")&&(this.loading=!0,this.configService.resetConfiguration().subscribe({next:e=>{this.configuration=e.config,this.populateForms(e.config),this.notificationService.showSuccess("Configuraci\xF3n restablecida"),this.loading=!1},error:e=>{console.error("Error resetting configuration:",e),this.notificationService.showError("Error al restablecer la configuraci\xF3n"),this.loading=!1}}))}get scheduleForm(){return this.schedulingForm}getWorkingHourControl(e){return this.schedulingForm.get("workingHours")?.get(e)}getDayName(e){return this.weekDays[e]?.label||""}getCurrentDate(){return new Date().toLocaleDateString("es-ES")}loadBackupData(){this.loadBackups(),this.loadBackupsByDate(),this.loadBackupStats()}loadBackups(){this.loadingBackups=!0,this.backupService.getBackups().subscribe({next:e=>{this.backups=e.sort((n,t)=>new Date(t.created).getTime()-new Date(n.created).getTime()),this.loadingBackups=!1},error:e=>{console.error("Error loading backups:",e),this.notificationService.showError("Error al cargar los backups"),this.loadingBackups=!1}})}loadBackupsByDate(){this.backupService.getBackupsByDate().subscribe({next:e=>{this.backupsByDate=e},error:e=>{console.error("Error loading grouped backups:",e)}})}loadBackupStats(){this.backupService.getBackupStats().subscribe({next:e=>{this.backupStats=e},error:e=>{console.error("Error loading backup stats:",e)}})}createBackup(){this.creatingBackup=!0,this.backupService.createBackup().subscribe({next:e=>{e.success?(this.notificationService.showSuccess("backup creado exitosamente"),this.loadBackupData()):this.notificationService.showError(e.message||"Error al crear el backup"),this.creatingBackup=!1},error:e=>{console.error("Error creating backup:",e),this.notificationService.showError("Error al crear el backup"),this.creatingBackup=!1}})}refreshBackups(){this.loadBackupData(),this.notificationService.showInfo("Lista de backups actualizada")}confirmRestore(e){confirm(`\xBFEst\xE1s seguro de que quieres restaurar el backup del ${this.formatDate(e.created)}?

Esta acci\xF3n reemplazar\xE1 todos los datos actuales.`)&&this.restoreBackup(e)}restoreBackup(e){this.backupService.restoreBackup(e.fileName).subscribe({next:n=>{n.success?(this.notificationService.showSuccess("backup restaurado exitosamente"),window.location.reload()):this.notificationService.showError(n.message||"Error al restaurar el backup")},error:n=>{console.error("Error restoring backup:",n),this.notificationService.showError("Error al restaurar el backup")}})}confirmDelete(e){confirm(`\xBFEst\xE1s seguro de que quieres eliminar el backup del ${this.formatDate(e.created)}?

Esta acci\xF3n no se puede deshacer.`)&&this.deleteBackup(e)}deleteBackup(e){this.backupService.deleteBackup(e.fileName).subscribe({next:n=>{n.success?(this.notificationService.showSuccess("backup eliminado exitosamente"),this.loadBackupData()):this.notificationService.showError(n.message||"Error al eliminar el backup")},error:n=>{console.error("Error deleting backup:",n),this.notificationService.showError("Error al eliminar el backup")}})}downloadBackup(e){this.backupService.downloadBackup(e.fileName).subscribe({next:n=>{let t=window.URL.createObjectURL(n),l=document.createElement("a");l.href=t,l.download=e.fileName,l.click(),window.URL.revokeObjectURL(t),this.notificationService.showSuccess("Descarga iniciada")},error:n=>{console.error("Error downloading backup:",n),this.notificationService.showError("Error al descargar el backup")}})}formatDate(e){return this.utils.formatDate(e)}getRelativeTime(e){let n=new Date(e),l=new Date().getTime()-n.getTime(),d=Math.floor(l/(1e3*60*60)),C=Math.floor(d/24);if(C>0)return`hace ${C} d\xEDa${C>1?"s":""}`;if(d>0)return`hace ${d} hora${d>1?"s":""}`;{let E=Math.floor(l/6e4);return E>0?`hace ${E} minuto${E>1?"s":""}`:"hace un momento"}}getBackupType(e){return e.includes("weekly")||e.includes("sunday")?"Semanal":e.includes("daily")?"Diario":"Manual"}getBackupTypeBadge(e){switch(this.getBackupType(e)){case"Semanal":return"bg-info text-dark";case"Diario":return"bg-success";case"Manual":return"bg-warning text-dark";default:return"bg-secondary"}}toggleViewMode(){this.viewMode=this.viewMode==="grouped"?"list":"grouped"}getBackupTypeLabel(e){return{daily:"Diario",weekly:"Semanal",manual:"Manual",legacy:"Manual",unknown:"Desconocido"}[e]||"Desconocido"}exportPatientsToCSV(){this.exportingPatients=!0,this.patientService.getPatients({limit:1e3}).subscribe({next:e=>{try{let n=e.patients,t=this.generatePatientsCSV(n);this.downloadCSV(t,`exportacion_pacientes_${this.getCurrentDateString()}.csv`),this.notificationService.showSuccess(`Exportados ${n.length} pacientes exitosamente`)}catch(n){console.error("Error generating CSV:",n),this.notificationService.showError("Error al generar el archivo CSV")}this.exportingPatients=!1},error:e=>{console.error("Error exporting patients:",e),this.notificationService.showError("Error al exportar los datos de pacientes"),this.exportingPatients=!1}})}generatePatientsCSV(e){let n=["DNI/NIE","Nombre","Apellidos","Fecha Nacimiento","Tel\xE9fono Principal","Tel\xE9fono Secundario","Email","Contacto Familiar","Direcci\xF3n","C\xF3digo Postal","Ciudad","Provincia","Notas M\xE9dicas","Total Citas","Bonos Activos","Cr\xE9ditos Disponibles","Fecha Registro","\xDAltima Actualizaci\xF3n"],t=e.map(d=>{let C=d._count?.appointments||0,E=d.creditPacks?.length||0,te=d.creditPacks?.reduce((ie,ne)=>ie+(ne.unitsRemaining||0),0)||0;return[this.escapeCSVField(d.dni||"-"),this.escapeCSVField(d.firstName||"-"),this.escapeCSVField(d.lastName||"-"),this.escapeCSVField(d.birthDate?this.formatDateForCSV(d.birthDate):"-"),this.escapeCSVField(d.phone||"-"),this.escapeCSVField(d.phone2||"-"),this.escapeCSVField(d.email||"-"),this.escapeCSVField(d.family_contact||"-"),this.escapeCSVField(d.address||"-"),this.escapeCSVField(d.cp||"-"),this.escapeCSVField(d.city||"-"),this.escapeCSVField(d.province||"-"),this.escapeCSVField(d.notes||"-"),this.escapeCSVField(C.toString()),this.escapeCSVField(E.toString()),this.escapeCSVField(te.toString()),this.escapeCSVField(d.fechaRegistro?this.formatDateForCSV(d.fechaRegistro):"-"),this.escapeCSVField(d.updatedAt?this.formatDateTimeForCSV(d.updatedAt):"-")]});return[n.join(";"),...t.map(d=>d.join(";"))].join(`\r
`)}escapeCSVField(e){return e.includes(";")||e.includes(",")||e.includes('"')||e.includes(`
`)||e.includes("\r")?`"${e.replace(/"/g,'""')}"`:e}formatDateForCSV(e){return new Date(e).toLocaleDateString("es-ES")}formatDateTimeForCSV(e){let n=new Date(e);return`${n.toLocaleDateString("es-ES")} ${n.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}`}downloadCSV(e,n){let t=new Blob(["\uFEFF"+e],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a");if(l.download!==void 0){let d=URL.createObjectURL(t);l.setAttribute("href",d),l.setAttribute("download",n),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(d)}}getCurrentDateString(){let e=new Date,n=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${n}${t}${l}`}getBackupTypeBadgeClass(e){return{daily:"bg-success",weekly:"bg-info text-dark",manual:"bg-warning text-dark",legacy:"bg-secondary",unknown:"bg-secondary"}[e]||"bg-secondary"}formatTime(e){return this.utils.formatTime(e)}isFirstOverall(e){return this.backups.length===0?!1:this.backups[0].fileName===e.fileName}objectValues(e){return Object.values(e)}objectKeys(e){return Object.keys(e)}loadPrices(){console.log("\u{1F504} Cargando precios..."),this.loadingPrices=!0,this.configService.getPrices().subscribe({next:e=>{console.log("\u2705 Precios cargados desde servidor:",e);let n={sessionPrice30:e.sessionPrice30??25,sessionPrice60:e.sessionPrice60??45,bonoPrice30:e.bonoPrice30??100,bonoPrice60:e.bonoPrice60??180};console.log("\u{1F4DD} Aplicando valores al formulario:",n),this.pricesForm.patchValue(n),this.loadingPrices=!1},error:e=>{console.error("\u274C Error loading prices:",e),this.notificationService.showError("Error al cargar los precios"),this.loadingPrices=!1}})}savePrices(){if(this.pricesForm.invalid){this.notificationService.showError("Por favor, verifica que todos los precios sean v\xE1lidos");return}let e=this.pricesForm.value;if(console.log("\u{1F4BE} Guardando precios:",e),e.sessionPrice60<=e.sessionPrice30){this.notificationService.showError("El precio de sesi\xF3n de 60 min debe ser mayor que el de 30 min");return}if(e.bonoPrice30/5>=e.sessionPrice30){this.notificationService.showError("El precio unitario del bono 30min debe ser menor que el precio de sesi\xF3n individual");return}if(e.bonoPrice60/5>=e.sessionPrice60){this.notificationService.showError("El precio unitario del bono 60min debe ser menor que el precio de sesi\xF3n individual");return}this.loadingPrices=!0,this.configService.updatePrices(e).subscribe({next:l=>{console.log("\u2705 Precios guardados exitosamente:",l),this.notificationService.showSuccess("Precios actualizados correctamente"),this.loadingPrices=!1},error:l=>{console.error("\u274C Error saving prices:",l),this.notificationService.showError("Error al guardar los precios"),this.loadingPrices=!1}})}resetPrices(){this.pricesForm.patchValue({sessionPrice30:25,sessionPrice60:45,bonoPrice30:100,bonoPrice60:180})}getSessionUnitPrice(e){let n=this.pricesForm.value;return e==="bono30"?n.bonoPrice30?n.bonoPrice30/5:0:n.bonoPrice60?n.bonoPrice60/5:0}getFormattedSessionUnitPrice(e){return this.getSessionUnitPrice(e).toFixed(2)}};m.\u0275fac=function(n){return new(n||m)(y(K),y(Z),y(Q),y(ee),y(W),y(X))},m.\u0275cmp=B({type:m,selectors:[["app-configuracion"]],decls:196,vars:49,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],["id","configTabs","role","tablist",1,"nav","nav-tabs","mb-4"],["role","presentation",1,"nav-item"],["id","clinic-tab","type","button","role","tab",1,"nav-link",3,"click"],[1,"bi","bi-building"],["id","prices-tab","type","button","role","tab",1,"nav-link",3,"click"],[1,"bi","bi-currency-euro"],["id","backup-tab","type","button","role","tab",1,"nav-link",3,"click"],[1,"bi","bi-shield-check"],["id","configTabsContent",1,"tab-content"],["id","clinic-pane","role","tabpanel",1,"tab-pane","fade"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],["src","assets/logo-clinica.png","alt","Logo Cl\xEDnica",1,"config-logo"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"col-md-6","mb-3"],["for","clinicName",1,"form-label"],["type","text","id","clinicName","formControlName","name","placeholder","Masaje Corporal Deportivo","autofocus","","tabindex","0",1,"form-control",2,"z-index","1060"],["class","text-danger small",4,"ngIf"],["for","clinicPhone",1,"form-label"],["type","tel","id","clinicPhone","formControlName","phone","placeholder","+34 123 456 789","tabindex","0",1,"form-control",2,"z-index","1060"],["for","clinicEmail",1,"form-label"],["type","email","id","clinicEmail","formControlName","email","placeholder","contacto@clinica.com","tabindex","0",1,"form-control",2,"z-index","1060"],["for","clinicAddress",1,"form-label"],["id","clinicAddress","formControlName","address","rows","3","placeholder","Calle Principal 123, Ciudad","tabindex","0",1,"form-control",2,"z-index","1060"],[1,"d-flex","justify-content-end"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","bi bi-save me-2",4,"ngIf"],["id","prices-pane","role","tabpanel",1,"tab-pane","fade"],[1,"bi","bi-currency-euro","me-2"],[1,"text-muted"],[3,"formGroup"],[1,"col-md-6"],[1,"card","border-primary"],[1,"card-header","bg-primary","text-white"],[1,"bi","bi-clock","me-2"],[1,"mb-3"],["for","sessionPrice30",1,"form-label"],[1,"bi","bi-stopwatch","me-1"],[1,"input-group"],["type","number","id","sessionPrice30","formControlName","sessionPrice30","min","0","step","0.01","placeholder","0.00","tabindex","0",1,"form-control",2,"z-index","1060"],[1,"input-group-text"],["for","sessionPrice60",1,"form-label"],[1,"bi","bi-clock","me-1"],["type","number","id","sessionPrice60","formControlName","sessionPrice60","min","0","step","0.01","placeholder","0.00","tabindex","0",1,"form-control",2,"z-index","1060"],[1,"card","border-success"],[1,"card-header","bg-success","text-white"],[1,"bi","bi-ticket-perforated","me-2"],["for","bonoPrice30",1,"form-label"],["type","number","id","bonoPrice30","formControlName","bonoPrice30","min","0","step","0.01","placeholder","0.00","tabindex","0",1,"form-control",2,"z-index","1060"],[1,"form-text"],["for","bonoPrice60",1,"form-label"],["type","number","id","bonoPrice60","formControlName","bonoPrice60","min","0","step","0.01","placeholder","0.00","tabindex","0",1,"form-control",2,"z-index","1060"],[1,"row","mt-4"],[1,"d-flex","gap-2","justify-content-end"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"bi","bi-arrow-clockwise","me-2"],["type","button",1,"btn","btn-success",3,"click","disabled"],[1,"bi","bi-check2-circle","me-2"],[1,"alert","alert-info"],[1,"bi","bi-info-circle","me-2"],["id","backup-pane","role","tabpanel",1,"tab-pane","fade"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"btn-group"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","bi bi-plus-circle me-2",4,"ngIf"],["type","button","title","Exportar todos los datos de pacientes a CSV",1,"btn","btn-success",3,"click","disabled"],["class","bi bi-download me-2",4,"ngIf"],["class","row mb-4",4,"ngIf"],[1,"card","mb-4"],[1,"mb-0"],[1,"d-flex","align-items-center"],[1,"bi","bi-calendar-day","text-primary","me-3","fs-4"],[1,"mb-1"],[1,"mt-1"],[1,"badge","bg-success"],[1,"bi","bi-check-circle"],[1,"bi","bi-calendar-week","text-info","me-3","fs-4"],["type","button",1,"btn","btn-outline-secondary","btn-sm","me-2",3,"click"],[1,"bi"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-arrow-clockwise"],["class","text-center py-4",4,"ngIf"],[4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-white bg-opacity-75","style","z-index: 1050;",4,"ngIf"],[1,"text-danger","small"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-save","me-2"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-plus-circle","me-2"],[1,"bi","bi-download","me-2"],[1,"row","mb-4"],[1,"col-md-3"],[1,"card","bg-primary","text-white"],[1,"card-body","text-center"],[1,"bi","bi-database","fs-1"],[1,"mt-2"],[1,"card","bg-success","text-white"],[1,"bi","bi-clock","fs-1"],[1,"card","bg-info","text-white"],[1,"bi","bi-hdd","fs-1"],[1,"card","bg-warning","text-white"],[1,"bi","bi-calendar-week","fs-1"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],[1,"bi","bi-inbox","text-muted",2,"font-size","3rem"],[1,"mt-3","text-muted"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"text-primary","mb-3"],[1,"bi","bi-calendar3","me-2"],["class","col-md-6 col-lg-4 mb-3",4,"ngFor","ngForOf"],[1,"col-md-6","col-lg-4","mb-3"],[1,"card","backup-card","h-100"],[1,"card-body","p-3"],[1,"d-flex","justify-content-between","align-items-start","mb-2"],[1,"badge"],["class","badge bg-success",4,"ngIf"],[1,"card-title","small","mb-2"],[1,"small","text-muted","mb-3"],[1,"bi","bi-hdd","me-1"],["role","group",1,"btn-group","w-100"],["type","button","title","Descargar",1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"bi","bi-download"],["type","button","title","Restaurar",1,"btn","btn-outline-warning","btn-sm",3,"click","disabled"],["type","button","title","Eliminar",1,"btn","btn-outline-danger","btn-sm",3,"click","disabled"],[1,"bi","bi-trash"],[1,"bi","bi-star-fill"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[1,"text-center"],[3,"table-success",4,"ngFor","ngForOf"],[1,"d-flex","flex-column"],[1,"fw-semibold"],[1,"font-monospace","small"],["class","badge bg-success ms-2",4,"ngIf"],[1,"badge","bg-light","text-dark"],["role","group",1,"btn-group","btn-group-sm"],["type","button","title","Descargar",1,"btn","btn-outline-info",3,"click"],["type","button","title","Restaurar",1,"btn","btn-outline-warning",3,"click","disabled"],["type","button","title","Eliminar",1,"btn","btn-outline-danger",3,"click","disabled"],[1,"badge","bg-success","ms-2"],[1,"position-fixed","top-0","start-0","w-100","h-100","d-flex","align-items-center","justify-content-center","bg-white","bg-opacity-75",2,"z-index","1050"]],template:function(n,t){if(n&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3)(4,"li",4)(5,"button",5),b("click",function(){return t.activeTab="clinic"}),c(6,"i",6),o(7," Informaci\xF3n de la Cl\xEDnica "),r()(),i(8,"li",4)(9,"button",7),b("click",function(){return t.switchToPricesTab()}),c(10,"i",8),o(11," Precios "),r()(),i(12,"li",4)(13,"button",9),b("click",function(){return t.activeTab="backup"}),c(14,"i",10),o(15," Backup "),r()()(),i(16,"div",11)(17,"div",12)(18,"div",13)(19,"div",14)(20,"h4",15),c(21,"img",16),o(22," Informaci\xF3n de la Cl\xEDnica "),r()(),i(23,"div",17)(24,"form",18),b("ngSubmit",function(){return t.saveClinicInfo()}),i(25,"div",1)(26,"div",19)(27,"label",20),o(28,"Nombre de la Cl\xEDnica"),r(),c(29,"input",21),f(30,ae,2,0,"div",22),r(),i(31,"div",19)(32,"label",23),o(33,"Tel\xE9fono"),r(),c(34,"input",24),r()(),i(35,"div",1)(36,"div",19)(37,"label",25),o(38,"Email"),r(),c(39,"input",26),f(40,se,2,0,"div",22),r(),i(41,"div",19)(42,"label",27),o(43,"Direcci\xF3n"),r(),c(44,"textarea",28),r()(),i(45,"div",29)(46,"button",30),f(47,ce,1,0,"span",31)(48,le,1,0,"i",32),o(49),r()()()()()(),i(50,"div",33)(51,"div",13)(52,"div",14)(53,"h4",15),c(54,"i",34),o(55," Gesti\xF3n de Precios "),r(),i(56,"small",35),o(57,"Configura los precios de sesiones y bonos. Los cambios solo afectar\xE1n a nuevos packs creados."),r()(),i(58,"div",17)(59,"form",36)(60,"div",1)(61,"div",37)(62,"div",38)(63,"div",39)(64,"h5",15),c(65,"i",40),o(66," Sesiones Individuales "),r()(),i(67,"div",17)(68,"div",41)(69,"label",42),c(70,"i",43),o(71," Sesi\xF3n 30 minutos "),r(),i(72,"div",44),c(73,"input",45),i(74,"span",46),o(75,"\u20AC"),r()()(),i(76,"div",41)(77,"label",47),c(78,"i",48),o(79," Sesi\xF3n 60 minutos "),r(),i(80,"div",44),c(81,"input",49),i(82,"span",46),o(83,"\u20AC"),r()()()()()(),i(84,"div",37)(85,"div",50)(86,"div",51)(87,"h5",15),c(88,"i",52),o(89," Bonos (Paquetes de 5 sesiones) "),r()(),i(90,"div",17)(91,"div",41)(92,"label",53),c(93,"i",43),o(94," Bono 5\xD730 minutos "),r(),i(95,"div",44),c(96,"input",54),i(97,"span",46),o(98,"\u20AC"),r()(),i(99,"div",55)(100,"small"),o(101),r()()(),i(102,"div",41)(103,"label",56),c(104,"i",48),o(105," Bono 5\xD760 minutos "),r(),i(106,"div",44),c(107,"input",57),i(108,"span",46),o(109,"\u20AC"),r()(),i(110,"div",55)(111,"small"),o(112),r()()()()()()()(),i(113,"div",58)(114,"div",2)(115,"div",59)(116,"button",60),b("click",function(){return t.resetPrices()}),c(117,"i",61),o(118," Restaurar "),r(),i(119,"button",62),b("click",function(){return t.savePrices()}),c(120,"i",63),f(121,de,1,0,"span",31),o(122),r()()()(),i(123,"div",58)(124,"div",2)(125,"div",64),c(126,"i",65),i(127,"strong"),o(128,"Importante:"),r(),o(129," Los cambios de precios solo afectan a los nuevos packs que se creen a partir de ahora. Los packs existentes y las citas ya agendadas mantendr\xE1n sus precios originales. "),r()()()()()(),i(130,"div",66)(131,"div",13)(132,"div",67)(133,"div")(134,"h4",15),o(135,"\u{1F4BE} Gesti\xF3n de Backup"),r(),i(136,"small",35),o(137,"Administra las copias de seguridad de la base de datos"),r()(),i(138,"div",68)(139,"button",69),b("click",function(){return t.createBackup()}),f(140,ue,1,0,"span",70)(141,me,1,0,"i",71),o(142),r(),i(143,"button",72),b("click",function(){return t.exportPatientsToCSV()}),f(144,pe,1,0,"span",70)(145,ge,1,0,"i",73),o(146),r()()(),i(147,"div",17),f(148,be,33,4,"div",74),i(149,"div",75)(150,"div",14)(151,"h6",76),o(152,"\u2699\uFE0F Configuraci\xF3n Autom\xE1tica"),r()(),i(153,"div",17)(154,"div",1)(155,"div",37)(156,"div",77),c(157,"i",78),i(158,"div")(159,"h6",79),o(160,"backup Diario"),r(),i(161,"small",35),o(162,"Todos los d\xEDas a las 2:00 AM"),r(),i(163,"div",80)(164,"span",81),c(165,"i",82),o(166," Activo "),r()()()()(),i(167,"div",37)(168,"div",77),c(169,"i",83),i(170,"div")(171,"h6",79),o(172,"backup Semanal"),r(),i(173,"small",35),o(174,"Domingos a las 3:00 AM"),r(),i(175,"div",80)(176,"span",81),c(177,"i",82),o(178," Activo "),r()()()()()()()(),i(179,"div",13)(180,"div",67)(181,"h6",76),o(182,"\u{1F4BE} Backups por Fecha"),r(),i(183,"div")(184,"button",84),b("click",function(){return t.toggleViewMode()}),c(185,"i",85),o(186),r(),i(187,"button",86),b("click",function(){return t.refreshBackups()}),c(188,"i",87),o(189," Actualizar "),r()()(),i(190,"div",17),f(191,fe,6,0,"div",88)(192,he,6,0,"div",88)(193,Ce,2,1,"div",89)(194,ye,16,1,"div",90),r()()()()()(),f(195,Ee,7,0,"div",91),r()()()),n&2){let l,d;a(5),x("active",t.activeTab==="clinic"),a(4),x("active",t.activeTab==="prices"),a(4),x("active",t.activeTab==="backup"),a(4),x("show",t.activeTab==="clinic")("active",t.activeTab==="clinic"),a(7),p("formGroup",t.clinicForm),a(6),p("ngIf",((l=t.clinicForm.get("name"))==null?null:l.hasError("required"))&&((l=t.clinicForm.get("name"))==null?null:l.touched)),a(10),p("ngIf",((d=t.clinicForm.get("email"))==null?null:d.hasError("email"))&&((d=t.clinicForm.get("email"))==null?null:d.touched)),a(6),p("disabled",t.saving||t.clinicForm.invalid),a(),p("ngIf",t.saving),a(),p("ngIf",!t.saving),a(),h(" ",t.saving?"Guardando...":"Guardar Informaci\xF3n"," "),a(),x("show",t.activeTab==="prices")("active",t.activeTab==="prices"),a(9),p("formGroup",t.pricesForm),a(42),h("Precio por sesi\xF3n: ",t.getFormattedSessionUnitPrice("bono30"),"\u20AC"),a(11),h("Precio por sesi\xF3n: ",t.getFormattedSessionUnitPrice("bono60"),"\u20AC"),a(4),p("disabled",t.loadingPrices),a(3),p("disabled",t.loadingPrices||t.pricesForm.invalid),a(2),p("ngIf",t.loadingPrices),a(),h(" ",t.loadingPrices?"Guardando...":"Guardar Precios"," "),a(8),x("show",t.activeTab==="backup")("active",t.activeTab==="backup"),a(9),p("disabled",t.creatingBackup),a(),p("ngIf",t.creatingBackup),a(),p("ngIf",!t.creatingBackup),a(),h(" ",t.creatingBackup?"Creando...":"Crear Backup"," "),a(),p("disabled",t.exportingPatients),a(),p("ngIf",t.exportingPatients),a(),p("ngIf",!t.exportingPatients),a(),h(" ",t.exportingPatients?"Exportando...":"Exportar Pacientes CSV"," "),a(2),p("ngIf",t.backupStats),a(37),w(t.viewMode==="grouped"?"bi-list":"bi-calendar3"),a(),h(" ",t.viewMode==="grouped"?"Vista Lista":"Vista Fecha"," "),a(5),p("ngIf",t.loadingBackups),a(),p("ngIf",!t.loadingBackups&&t.objectKeys(t.backupsByDate).length===0),a(),p("ngIf",!t.loadingBackups&&t.viewMode==="grouped"&&t.objectKeys(t.backupsByDate).length>0),a(),p("ngIf",!t.loadingBackups&&t.viewMode==="list"&&t.backups.length>0),a(),p("ngIf",t.loading)}},dependencies:[V,O,I,Y,U,A,q,z,L,G,J,R,H],styles:[".configuracion-container[_ngcontent-%COMP%]{padding:24px;max-width:1000px;margin:0 auto}.configuracion-header[_ngcontent-%COMP%]{margin-bottom:24px;text-align:center}.backup-card[_ngcontent-%COMP%]{transition:all .3s ease;border:1px solid #dee2e6}.backup-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.backup-card.border-success[_ngcontent-%COMP%]{border-color:#198754!important;box-shadow:0 2px 8px #19875433}.backup-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{position:relative}.backup-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:.3rem .6rem}.backup-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1;padding:.375rem .5rem;font-size:.8rem}.table-success[_ngcontent-%COMP%]{--bs-table-bg: rgba(25, 135, 84, .1);border-left:4px solid #198754}.configuracion-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-weight:500}.configuracion-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.configuracion-content[_ngcontent-%COMP%]{min-height:400px}.tab-content[_ngcontent-%COMP%]{padding:24px 0}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px;flex-wrap:wrap}.full-width[_ngcontent-%COMP%]{flex:1;min-width:100%}.half-width[_ngcontent-%COMP%]{flex:1;min-width:250px}.section[_ngcontent-%COMP%]{margin-bottom:32px}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;color:#333;font-size:18px;font-weight:500}.day-config[_ngcontent-%COMP%]{margin-bottom:24px;border:1px solid #e0e0e0;border-radius:8px;padding:16px;background-color:#fafafa}.day-header[_ngcontent-%COMP%]{margin-bottom:16px}.day-hours[_ngcontent-%COMP%]{display:flex;gap:24px;flex-wrap:wrap}.hours-section[_ngcontent-%COMP%]{flex:1;min-width:200px}.hours-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#555;font-size:14px;font-weight:500}.time-inputs[_ngcontent-%COMP%]{display:flex;gap:12px}.time-inputs[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{flex:1}.system-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.action-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border:1px solid #e0e0e0;border-radius:8px;background-color:#fafafa}.action-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;color:#333;font-size:16px;font-weight:500}.action-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.info-card[_ngcontent-%COMP%]{margin-top:16px}.system-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.info-item[_ngcontent-%COMP%]{color:#666;font-size:14px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:#666}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px}@media (max-width: 768px){.configuracion-container[_ngcontent-%COMP%]{padding:16px}.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{min-width:unset}.day-hours[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.time-inputs[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.action-item[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:16px}.action-info[_ngcontent-%COMP%]{text-align:center}}.config-logo[_ngcontent-%COMP%]{height:1.5rem;width:auto;max-width:1.5rem;object-fit:contain;margin-right:.5rem;vertical-align:baseline}"]});let s=m;return s})();export{Ne as ConfiguracionComponent};
